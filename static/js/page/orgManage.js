define(["jquery","utils","config","accountAPI","layer","pagination","remodal"],function(t,n,e,a){var o=t("[data-remodal-id=addOrgModal]").remodal(),i=t("[data-remodal-id=changeOrgModal]").remodal(),r=t(".data-container table tbody input[type=checkbox]:checked"),c=t("body"),l={init:function(){this.render(),this.bindEvents()},render:function(){this.initModal(),this.fnGetList({},!0)},bindEvents:function(){this.onAdd(),this.onOpen(),this.onClose(),this.onDel(),this.onChange(),this.onSearch()},initModal:function(){t(".J_showAdd").on("click",function(){o.open()}),c.on("click",".J_showChangeOrg",function(){var n=t(this),e=n.parents("tr").find("td"),a=e.eq(1).text(),o=e.eq(2).text(),r=(e.eq(3).text(),e.eq(4).text(),e.eq(5).text()),c=e.eq(6).text(),l=t(".changeOrgModal .modalForm");l.find("input[name=orgId]").val(a),l.find("input[name=orgName]").val(o),l.find("input[name=orgLevel]").val(o),l.find("input[name=orgType]").val(o),l.find("input[name=phone]").val(r),l.find("input[name=cellphone]").val(c),i.open()}),t(document).on("closed",".remodal",function(n){t(this).find(".modalForm")[0].reset()})},onAdd:function(){var n=t(".addOrgModal .remodal-confirm");n.on("click",function(n){n.preventDefault();var e=t(this);if(!e.hasClass("disabled")){e.addClass("disabled");var i={};a.addOrg(i,function(t){console.log(t),o.close(),e.removeClass("disabled")})}})},onUpdateUserStatus:function(){var n=this;t(".J_updateStatus").on("click",function(){var o=n.fnGetSelect();if(!o.length)return void layer.msg("请选择要操作的数据");var i={id:o,status:t(this).hasClass("open-i")?0:1},c=0===i.status?"启用成功":"禁用成功";n.fnGetList({},!0),layer.msg(c),a.updateOrgStatus(i,function(){var n=0===i.status?"启用成功":"禁用成功";0==result.cade?(layer.msg(n),r.each(function(){t(this).parents("tr").find("td").eq(7).text(e.orgStatus[i.status])})):layer.msg("操作失败")})})},onOpen:function(){t(".J_showOpen").on("click",function(){var o=n.getCheckedArr();o.length>0?layer.confirm("确定启用选中的列表项吗？",{icon:3},function(n){a.openOrg(o,function(n){r.each(function(){t(this).parents("tr").find("td").eq(7).text(e.orgStatus[1])})}),layer.close(n)}):layer.alert("请先选择要启用的列表项")})},onClose:function(){t(".J_showClose").on("click",function(){var o=n.getCheckedArr();o.length>0?layer.confirm("确定禁用选中的列表项吗？",{icon:3},function(n){a.closeOrg(o,function(n){r.each(function(){t(this).parents("tr").find("td").eq(7).text(e.orgStatus[2])})}),layer.close(n)}):layer.alert("请先选择要禁用的列表项")})},onDel:function(){t(".J_showDel").on("click",function(){var e=n.getCheckedArr();e.length>0?layer.confirm("确定删除选中的列表项吗？",{icon:3},function(n){a.delOrg(e,function(n){r.each(function(){t(this).parents("tr").remove()})}),layer.close(n)}):layer.alert("请先选择要删除的列表项",{icon:0})})},onChange:function(){t(".changeOrgModal .remodal-confirm").on("click",function(){var t={};a.changeOrg(t,function(t){layer.msg("修改成功")})})},onSearch:function(){var n=this;t(".J_search").on("click",function(){var e=t("input[name=type]").val(),a=t("input[name=level]").val(),o=t("input[name=orgName]").val()||"",i={page:1,type:e,superMemberid:a,name:o};n.fnGetList(i,!0)})},onSelectAll:function(){n.selectAll()},fnGetList:function(n,o){var i=this,r=t(".data-container table");a.searchOrg(n,function(a){if(console.log("获取机构管理列表 调用成功!"),"0"==a.list.length)return r.find("tbody").empty().html("<tr><td colspan='9'>暂无记录</td></tr>"),t(".pagination").hide(),!1;var c,l='<td><input type="checkbox"></td>',d="<td><a class='J_showChangeOrg text-blue' href='javascript:;'>修改</a></td>";if(t.each(a.list,function(t,n){var a="<td>"+n.memberid+"</td>",o="<td>"+n.name+"</td>",i="<td>"+e.orgType[n.type]+"</td>",r="<td>"+n.superMemberInfo+"</td>",s="<td>"+n.phone+"</td>",u="<td>"+n.cellphone+"</td>",f="<td>"+e.orgStatus[n.orgStatus]+"</td>";c+='<tr class="fadeIn animated">'+l+a+o+i+r+s+u+f+d+"</tr>"}),r.find("tbody").empty().html(c),o){var s=a.totalPages;s>0&&(console.log("页数："+s),t(".pagination").show().html("").createPage({pageCount:s,current:1,backFn:function(t){var e=n;e.page=t,i.fnGetList(n)}}))}})},fnGetSelect:function(){var n=[];return t(".data-container table tbody tr").each(function(){var e=t(this);e.find("input[type=checkbox]").prop("checked")&&n.push(e.attr("data-id"))}),n}};l.init()});