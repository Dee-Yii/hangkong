define(["jquery","utils","config","accountAPI","layer","pagination","remodal"],function(e,a,t,n){var s,i=e("[data-remodal-id=addUserModal]").remodal(),d=e("[data-remodal-id=changeUserModal]").remodal(),r=e("[data-remodal-id=resetPwdModal]").remodal(),o=e("body"),m={init:function(){this.render(),this.bindEvents()},render:function(){this.initModal(),this.initOrgList(),this.fnGetList({},!0)},bindEvents:function(){this.onSearch(),this.onAdd(),this.onChange(),this.onDel(),this.onUpdateUserStatus(),this.onRestPwd()},initModal:function(){e(".J_showAdd").on("click",function(){i.open()}),o.on("click",".J_showChangeUser",function(){var a=e(this);s=a.parents("tr").attr("data-id");var t=a.parents("tr").find("td"),n=t.eq(4).text(),i=t.eq(1).text(),r=t.eq(2).text(),o=t.eq(3).text(),m=e(".changeUserModal .modalForm");m.find("input[name=orgName]").val(n),m.find("input[name=username]").val(i),m.find("input[name=nickname]").val(r),m.find("input[name=roleType]").val(o),d.open()}),o.on("click",".J_showResetPwd",function(){var a=e(this);s=a.parents("tr").attr("data-id");var t=a.parents("tr").find("td"),n=t.eq(1).text(),i=t.eq(2).text(),o=e(".resetPwdModal .modalForm");o.find("input[name=username]").val(n),o.find("input[name=nickname]").val(i),d.open(),r.open()}),e(document).on("closed",".remodal",function(a){e(this).find(".modalForm")[0].reset()})},initOrgList:function(){var a=e("select[name=org]"),t="",s={pageNum:"",page:""};n.getOrgList(s,function(n){console.log("机构列表-调用成功"),e.each(n.list,function(e,a){t+='<option value="'+a.memberId+'">'+a.name+"</option>"}),a.html(t)});var i={totalPages:1,pageNum:5,page:1,list:[{memberid:"1",name:"123",mark:"",type:"0",tel:null,phone:null,status:"0",superMemberid:"123"},{memberid:"123",name:"哈杀手",mark:"",type:"0",tel:null,phone:null,status:"0",superMemberid:"0",superMemberInfo:""},{memberid:"123",name:"在考虑进来",mark:"",type:"0",tel:null,phone:null,status:"0",superMemberid:"0",superMemberInfo:""}]};e.each(i.list,function(e,a){t+='<option value="'+a.memberId+'">'+a.name+"</option>"}),a.html(t)},onSearch:function(){},onAdd:function(){var a=e(".addUserModal .remodal-confirm"),t=e(".addUserModal form");a.on("click",function(){var a=e(this);if(!a.hasClass("disabled")){a.addClass("disabled");var s={memeberId:t.find("select").val(),uid:t.find("[name=username]").val(),password:t.find("[name=password]").val(),nickname:t.find("[name=nickname]").val()};layer.msg("新建成功"),i.close(),a.removeClass("disabled"),n.addOrg(s,function(e){i.close(),a.removeClass("disabled"),layer.msg("新建成功")})}})},onChange:function(){var a=e(".changeUserModal .remodal-confirm"),t=e(".changeUserModal form");a.on("click",function(){var a=e(this);if(!a.hasClass("disabled")){a.addClass("disabled");var i={id:s,memeberId:t.find("select").val(),uid:t.find("[name=username]").val(),password:t.find("[name=password]").val(),nickname:t.find("[name=nickname]").val()};layer.msg("修改成功"),d.close(),a.removeClass("disabled"),n.changeOrg(i,function(e){d.close(),a.removeClass("disabled"),layer.msg("修改成功")})}})},onDel:function(){var a=this;e(".J_onDel").on("click",function(){var t=a.fnGetSelect();if(!t.length)return void layer.msg("请选择要操作的数据");var s={id:t,status:e(this).hasClass("open-i")?0:1};layer.msg("删除成功"),a.fnGetList({},!0),n.updateUserStatus(s,function(e){0==e.cade?(layer.msg("删除成功"),a.fnGetList({},!0)):layer.msg("删除失败")})})},onUpdateUserStatus:function(){var a=this;e(".J_updateStatus").on("click",function(){var t=a.fnGetSelect();if(!t.length)return void layer.msg("请选择要操作的数据");var s={id:t,status:e(this).hasClass("open-i")?0:1},i=0===s.status?"启用成功":"禁用成功";a.fnGetList({},!0),layer.msg(i),n.updateUserStatus(s,function(){var e=0===s.status?"启用成功":"禁用成功";0==result.cade?(layer.msg(e),a.fnGetList({},!0)):layer.msg("操作失败")})})},onRestPwd:function(){var a=e(".resetPwdModal .remodal-confirm"),t=e(".resetPwdModal form");a.on("click",function(){var a=e(this);if(!a.hasClass("disabled")){a.addClass("disabled");var i={id:s,password:t.find("[name=password]").val()};layer.msg("重置密码成功"),r.close(),a.removeClass("disabled"),n.resetPwd(i,function(e){r.close(),a.removeClass("disabled"),layer.msg("重置密码成功")})}})},fnGetList:function(a,s){var i=this,d=e(".data-container table");n.getUserList(a,function(n){if(console.log("获取用户管理列表 调用成功!"),"0"==n.list.length)return d.find("tbody").empty().html("<tr><td colspan='9'>暂无记录</td></tr>"),e(".pagination").hide(),!1;var r,o='<td><input type="checkbox"></td>',m="<td><a class='J_showChangeUser text-blue' href='javascript:;'> 修改 </a> | <a class='J_showResetPwd text-blue' href='javascript:;'> 重置密码 </a></td>";if(e.each(n.list,function(e,a){var n="<td>"+a.uid+"</td>",s="<td>"+a.nickname+"</td>",i="<td>"+t.roleType[a.roleType||0]+"</td>",d="<td>"+a.memberInfo.name+"</td>",l="<td>"+a.cellphone+"</td>",c="<td>"+a.registerTime+"</td>",u="<td>"+t.userStatus[a.status]+"</td>";r+='<tr class="fadeIn animated" data-id="'+a.id+'">'+o+n+s+i+d+l+c+u+m+"</tr>"}),d.find("tbody").empty().html(r),s){var l=n.totalPages;l>0&&(console.log("页数："+l),e(".pagination").show().html("").createPage({pageCount:l,current:1,backFn:function(e){var t=a;t.page=e,i.fnGetList(a)}}))}});var r={totalPages:1,pageNum:5,page:1,list:[{id:"1",uid:"XA111",password:"QWEQW",nickname:"小白",cellphone:"1111",registerTime:"2017-05-03",status:"0",memberId:"1",memberInfo:{memberId:"1",name:"华东",type:"0",superMemberid:null}},{id:"2",uid:"qqq",password:"asdas",nickname:"暗示的话",cellphone:"aaa",registerTime:"2017-05-17",status:"0",memberId:"123",memberInfo:{memberId:"123",name:"按时",type:"0",superMemberid:"1"}},{id:"1",uid:"XA111",password:"QWEQW",nickname:"小白",cellphone:"1111",registerTime:"2017-05-03",status:"0",memberId:"1",memberInfo:{memberId:"1",name:"华东",type:"0",superMemberid:null}},{id:"2",uid:"qqq",password:"asdas",nickname:"暗示的话",cellphone:"aaa",registerTime:"2017-05-17",status:"0",memberId:"123",memberInfo:{memberId:"123",name:"按时",type:"0",superMemberid:"1"}},{id:"1",uid:"XA111",password:"QWEQW",nickname:"小白",cellphone:"1111",registerTime:"2017-05-03",status:"0",memberId:"1",memberInfo:{memberId:"1",name:"华东",type:"0",superMemberid:null}},{id:"2",uid:"qqq",password:"asdas",nickname:"暗示的话",cellphone:"aaa",registerTime:"2017-05-17",status:"0",memberId:"123",memberInfo:{memberId:"123",name:"按时",type:"0",superMemberid:"1"}},{id:"1",uid:"XA111",password:"QWEQW",nickname:"小白",cellphone:"1111",registerTime:"2017-05-03",status:"0",memberId:"1",memberInfo:{memberId:"1",name:"华东",type:"0",superMemberid:null}},{id:"2",uid:"qqq",password:"asdas",nickname:"暗示的话",cellphone:"aaa",registerTime:"2017-05-17",status:"0",memberId:"123",memberInfo:{memberId:"123",name:"按时",type:"0",superMemberid:"1"}},{id:"1",uid:"XA111",password:"QWEQW",nickname:"小白",cellphone:"1111",registerTime:"2017-05-03",status:"0",memberId:"1",memberInfo:{memberId:"1",name:"华东",type:"0",superMemberid:null}},{id:"2",uid:"qqq",password:"asdas",nickname:"暗示的话",cellphone:"aaa",registerTime:"2017-05-17",status:"0",memberId:"123",memberInfo:{memberId:"123",name:"按时",type:"0",superMemberid:"1"}}]};if(console.log("获取用户管理列表 调用成功!"),"0"==r.list.length)return d.find("tbody").empty().html("<tr><td colspan='9'>暂无记录</td></tr>"),e(".pagination").hide(),!1;var o,m='<td><input type="checkbox"></td>',l="<td><a class='J_showChangeUser text-blue' href='javascript:;'> 修改 </a> | <a class='J_showResetPwd text-blue' href='javascript:;'> 重置密码 </a></td>";if(e.each(r.list,function(e,a){var n="<td>"+a.uid+"</td>",s="<td>"+a.nickname+"</td>",i="<td>"+t.roleType[a.roleType||0]+"</td>",d="<td>"+a.memberInfo.name+"</td>",r="<td>"+a.cellphone+"</td>",c="<td>"+a.registerTime+"</td>",u="<td>"+t.userStatus[a.status]+"</td>";o+='<tr class="fadeIn animated" data-id="'+a.id+'">'+m+n+s+i+d+r+c+u+l+"</tr>"}),d.find("tbody").empty().html(o),s){var c=r.totalPages;c>0&&(console.log("页数："+c),e(".pagination").show().html("").createPage({pageCount:c,current:1,backFn:function(e){var t=a;t.page=e,i.fnGetList(a)}}))}},fnGetSelect:function(){var a=[];return e(".data-container table tbody tr").each(function(){var t=e(this);t.find("input[type=checkbox]").prop("checked")&&a.push(t.attr("data-id"))}),a}};m.init()});